<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
		<!-- 网站作者 -->
		<meta name="author" content="51区块研发团队">
		<!-- 网站关键词 -->
		<meta name="keywords" content="51区块,数字资产">
		<!-- 网站描述 -->
		<meta name="description" content="51区块">

		<title>资产详情| 51区块</title>

		<!-- Bootstrap.css -->
		<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">

		<!-- bootstrapValidator.css -->
		<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.min.css">

		<!-- public.css -->
		<link rel="stylesheet" href="/css/public.css">

		<!-- jQuery.js 1.11.1-->
		<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

		<!-- Bootstrap.js -->
		<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

		<!-- vue.js -->
		<script src="//cdn.bootcss.com/vue/1.0.24/vue.js"></script>
		<script src="//cdn.bootcss.com/vue-router/0.7.10/vue-router.min.js"></script>

		<!-- jquery.cookie.js -->
		<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
		<link href="/css/animate.css" rel="stylesheet">
	    <!--<link href="/css/style.css?v=4.1.0" rel="stylesheet">-->
	      <!-- 表格 -->
		<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
		<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/locale/bootstrap-table-zh-CN.min.js"></script>
		<style>
			.modal-dialog {
				z-index: 10000!important;
			}
			.input-group-btn {
				z-index: 1000;
			}
			.bs-callout-success {
	    		border-left: 3px solid #20b062;
	    		padding-left: 5px;
	    		font-weight: bold;
	    		font-size: 18px;
	    	}
	    	.img-responsive, 
	    	.thumbnail>img, 
	    	.thumbnail a>img, 
	    	.carousel-inner>.item>img, 
	    	.carousel-inner>.item>a>img {
				width: 100%;
				max-width: 1000px;
				margin-right: auto;
				margin-left: auto;
				min-height: 300px;
	    	}
	    	.fixed-table-toolbar {
	    		display: none;
	    	}
		</style>
	</head>
	<body class="gray-bg">
	    <div class="wrapper wrapper-content animated fadeIn container-fluid">
	        <div class="row">
	            <div class="col-sm-12">
	                <h3 class="bs-callout-success">
	                	<!--<a href="/tradeCenter/index" class="text-success">-->
						<!--交易中心-->
						<!--</a>-->
						${redemption}
	                	&nbsp;>&nbsp;
	                	<span>
	                		资产详情
	                	</span>
						<input type="hidden" value="${assetId}" id="assetId">
		            </h3>
	            </div>
	        </div>
	        <div class="row">
	        	<!-- 资产图片 -->
	        	<div class="col-sm-8">
	        		<div class="ibox float-e-margins">
	                    <div class="ibox-title">
	                        <h5>资产图片</h5>
	                    </div>
	                    <div class="ibox-content">
	                        <div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
							    <ol class="carousel-indicators">
							        <li data-target="#carousel-example-generic" data-slide-to="0" class=""></li>
							        <li data-target="#carousel-example-generic" data-slide-to="1" class=""></li>
							        <li data-target="#carousel-example-generic" data-slide-to="2" class="active"></li>
							    </ol>
							    <div class="carousel-inner" role="listbox" id="assetImg">
							    </div>
							    <a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
							        <span class="glyphicon glyphicon-chevron-left"></span>
							        <span class="sr-only">Previous</span>
							    </a>
							    <a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
							        <span class="glyphicon glyphicon-chevron-right"></span>
							        <span class="sr-only">Next</span>
							    </a>
						    </div>
	                    </div>
	                </div>
	        	</div>
	        	<!-- 资产基本信息 -->
	        	<div class="col-sm-4">
	        		<div class="row">
	        			<div class="col-xs-12">
	        				<!-- 资产信息 -->
	        				<div class="ibox float-e-margins">
			                    <div class="ibox-title">
			                        <h5>资产信息</h5>
			                    </div>
			                    <div class="ibox-content">
			                        <h1 id="assetName"></h1>
			                        <p>
			                        	<strong>资产详情:</strong>
			                        	<span id="assetDescription"></span>
			                        </p>
			                        <p>
			                        	<strong>资产估计:</strong>
			                        	<span><i class="text-danger"><span id="assetEval"></span></i>元</span>
			                        </p>
			                        <p>
			                        	<strong>担保公司:</strong>
			                        	<span id="guaranteeCorp"></span>
			                        </p>
			                        <!--<p>-->
			                        	<!--<strong>合同模板:</strong>-->
			                        	<!--<span>数字资产.doc <a href="" class=" text-info">下载</a></span>	-->
			                        <!--</p>-->
			                    </div>
			                </div>
	        			</div>
	        		</div>
	        		<div class="row">
	        			<div class="col-xs-12">
	        				<!-- 可交易份额 -->
	        				<div class="ibox float-e-margins">
			                    <div class="ibox-title">
			                        <h5>可交易份额</h5>
			                    </div>
			                    <div class="ibox-content">
			                        <table id="table" data-toggle="table" data-pagination="true" data-search="true" data-use-row-attr-func="true" data-reorderable-rows="true">
							        <!-- <table id="table" data-toggle="table" data-pagination="true" data-search="true" data-use-row-attr-func="true" data-reorderable-rows="true" data-url="/js/a.json"> -->
										<thead>
											<tr>
												<th data-field="holder" >
													持有人
												</th>
												<th data-field="circulation-share" data-sortable="true">
													流通份额
												</th>
												<th data-field="proportion" data-sortable="true">
													占资比例
												</th>
												<!--<th data-field="operation">-->
													<!--操作-->
												<!--</th>-->
											</tr>
										</thead>
									</table>
			                    </div>
			                </div>
	        			</div>
	        		</div>
	        	</div>
	        </div>
	    </div>

		<!-- 申请认购模态框 -->
		<div class="modal inmodal bs-example-modal-sm" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="mySmallModalLabel">
			<div class="modal-dialog">
				<div class="modal-content animated flipInX">
					<div class="modal-body">
						<form class="form-horizontal" role="form" id="tradeModal">
							<!-- 认购份额 -->
							<input type="hidden" value="" id="ownerId"/>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">认购份额(股)</label>
								<div class="col-xs-6">
									<div class="input-group">
										<input type="text" class="form-control" id="applyShare" placeholder="请输入认购份额">
										<span class="input-group-btn">
								        	<button class="btn btn-default" type="button">股</button>
								     	</span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">每股出价(元)</label>
								<!--<input type="text" class="form-control" id="unitPrice" placeholder="请输入认购单价，不低于1元/股">-->
								<div class="col-xs-6">
									<div class="input-group">
										<input type="text" class="form-control" id="unitPrice" placeholder="请输入认购单价，不低于1元/股">
										<span class="input-group-btn">
								        	<button class="btn btn-default" type="button">元</button>
								     	</span>
									</div>
								</div>
								<!--<span class="input-group-btn">-->
								        	<!--<button class="btn btn-default" type="button">元</button>-->
								     	<!--</span>-->
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label"></label>
								<div class="col-xs-6">
									<div class="row">
										<button class="col-xs-4 col-xs-offset-1 btn btn-success" onclick='applyDelivery(${assetId},$("#ownerId").val())'>
											提交申请
										</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!--发行人信息-->
		<div class="modal inmodal bs-example-modal-sm" id="myModal3" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="mySmallModalLabel">
			<div class="modal-dialog">
				<div class="modal-content animated flipInX">
					<div class="modal-body">
						<form class="form-horizontal" role="form" >
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">发行人</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="publishMan" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">证件类型</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control"  >身份证</span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">证件号码</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="identity" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">联系电话</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="telephone" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">邮箱</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="email" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label"></label>
								<div class="col-xs-6">
									<div class="row">
										<button data-dismiss="modal" class="col-xs-4 col-xs-offset-1 btn ">
											取消
										</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	    <script>
	    	var tableData = new Array();
			var assetId =$("#assetId").val();
			$.ajax({
				url : "../../assets/"+assetId+"",
				type : "get",
				async: false,
				success: function(result){
					console.log(result["data"]);
					$("#assetDescription").text(result["data"]["desc"]);
					if(result["data"]["guaranteed"]){
						$("#guaranteeCorp").text(result["data"]["guarName"]);
					}else{
						$("#guaranteeCorp").text("无");
					}
					$("#assetEval").text(result["data"]["value"]);
					$("#assetName").text(result["data"]["name"]);
					tradeUserAsset();
					var html = "<div class=\"item active\"><img data-src=\"holder.js/900x500/auto/#777:#555/text:First slide\" alt=\"First slide [900x500]\" src=\""+result["data"]["photoList"][0]+"\" data-holder-rendered=\"true\"></div>"
					$("#assetImg").append(html);
					for(var i = 1; i < result.data.photoList.length;i++){
						var html = "<div class=\"item \"><img data-src=\"holder.js/900x500/auto/#777:#555/text:Second slide\" alt=\"First slide [900x500]\" src=\""+result["data"]["photoList"][i]+"\" data-holder-rendered=\"true\"></div>"
						$("#assetImg").append(html);
					}
				}
			})
		function tradeUserAsset(){
			$.ajax({
				url : "../../assets/"+assetId+"/digitassets/",
				type : "get",
				async: false,
				success: function(result){
					console.log(result);
					for (var i = 0; i < result.data.length; i++) {
						tableData[i] = {
							"holder":  '<div class="btn-group"><button type="button" onclick=\'alertUserInfo("'+result.data[i].userInfo.realName+'","'+result.data[i].userInfo.identity+'","'+result.data[i].telephone+'","'+result.data[i].userInfo.email+'")\' class="btn btn-default">'+result.data[i].ownerName+'</button> </div>',
							"circulation-share": result["data"][i]["availShare"]+"股",
							"proportion": result["data"][i]["percent"]+"%"
//							"operation": "<a href='#'  class='text-success'  onclick='selfModal("+result.data[i].ownerId+")'  data-toggle='modal' data-target='#myModal2'>申请认购</a>"

						}
					}
				}
			})
		}
		function alertUserInfo(name,identity,telephone,email) {
			$("#publishMan").text(name);
			$("#identity").text(identity);
			if(telephone=="null"){
				$("#telephone").text("");
			}else{
				$("#telephone").text(telephone);
			}
			if(email=="null"){
				$("#email").text("");
			}else{
				$("#email").text(email);
			}
			$("#myModal3").show();
		}
		function selfModal(userId) {
			$("#ownerId").val(userId);
		}
		function applyDelivery(assetId,ownerId) {
			$.ajax({
				url : "/assetOrder/createOrder",
				type : "post",
				data : {"userId":ownerId,
					"assetId":assetId,
					"amount":$("#applyShare").val(),
					"unitPrice":$("#unitPrice").val()},
				async: false,
				success: function(result){
					console.log(result);
					if(result.meta.code==200){
						$("#modalAlert",parent.document).click();
						$(".modal-body",parent.document).html("申请成功");
					}else{
						$("#modalAlert",parent.document).click();
						$(".modal-body",parent.document).html(result.meta.message);
						return false;
					}
				}
			})


		}
			console.log(tableData[0]);
	    	$("#table").bootstrapTable({
                data: tableData
            });
	    </script>
	</body>
</html>