<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
    <!-- 网站作者 -->
    <meta name="author" content="51区块研发团队">
    <!-- 网站关键词 -->
    <meta name="keywords" content="51区块,数字资产">
    <!-- 网站描述 -->
    <meta name="description" content="51区块">

    <title>资产评估| 51区块</title>

    <!-- Bootstrap.css -->
    <link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">

    <!-- bootstrapValidator.css -->
    <link rel="stylesheet" href="//cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.min.css">

    <!-- public.css -->
    <link rel="stylesheet" href="/css/public.css">

    <!-- jQuery.js 1.11.1-->
    <script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

    <!-- Bootstrap.js -->
    <script src="//cdn.bootcss.com/bootstrap-validator/0.5.3/js/bootstrapValidator.min.js"></script>
    <script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>
    <!-- vue.js -->
    <script src="//cdn.bootcss.com/vue/1.0.24/vue.js"></script>
    <script src="//cdn.bootcss.com/vue-router/0.7.10/vue-router.min.js"></script>

    <!-- jquery.cookie.js -->
    <script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
    <link href="/css/animate.css" rel="stylesheet">
    <link href="/css/style.css?v=4.1.0" rel="stylesheet">
    <style>
        .modal-dialog {
            z-index: 10000!important;
        }
        .tab-content {
            margin-top: 10px;
            padding: 30px 40px;
        }
    </style>
    <!-- 表格 -->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/locale/bootstrap-table-zh-CN.min.js"></script>
</head>
<body class="gray-bg">
<div class="wrapper wrapper-content animated fadeIn container-fluid">
    <div class="row">
        <div class="col-sm-12">
            <!-- <h3 class="">

           </h3> -->
            <h3 class="bs-callout-success">
                资产评估
            </h3>
        </div>
        <div class="col-sm-12">
            <ul id="myTab" class="nav nav-tabs" role="tablist">
                <li role="presentation" class="active">
                    <a href="#tab1" id="" data-toggle="tab" aria-expanded="true">
                        待评估
                    </a>
                </li>
                <li role="presentation" class="">
                    <a href="#tab2" onclick="hasEvl()" id="" data-toggle="tab" aria-expanded="false">
                        已评估
                    </a>
                </li>
            </ul>
            <div id="myTabContent" class="tab-content panel panel-default">
                <!-- 待评估 -->
                <div class="tab-pane fade active in" id="tab1">
                    <div class="row">
                        <!-- <div class="col-sm-12"> -->
                        <table id="table1" data-toggle="table" data-pagination="true" data-search="true"
                               data-use-row-attr-func="true" data-reorderable-rows="true">
                            <thead>
                            <tr>
                                <th data-field="name" data-sortable="true">
                                    资产名称
                                </th>
                                <th data-field="id" data-sortable="true">
                                    资产编号
                                </th>
                                <th data-field="description" data-sortable="true">
                                    描述
                                </th>
                                <th data-field="cycle" data-sortable="true">
                                    发行周期
                                </th>
                                <th data-field="publishName" data-sortable="true">
                                    发行人
                                </th>
                                <th data-field="operations" data-sortable="true">
                                    操作
                                </th>
                            </tr>
                            </thead>
                            <tr>
                                <!--<#list orderCenterCmds as orderCenterCmd>-->
                                <!--<td>${orderCenterCmd.assetName!""}</td>-->
                                <!--<td>${orderCenterCmd.assetId!""}</td>-->
                                <!--<td>${orderCenterCmd.ApplicationShare!""}</td>-->
                                <!--<td>${orderCenterCmd.percent!""}</td>-->
                                <!--<td>${orderCenterCmd.endTime?date}</td>-->
                                <!--<td>${orderCenterCmd.guarName!""}</td>-->
                                <!--<td>${orderCenterCmd.holderName!""}</td>-->
                                <!--<td>${orderCenterCmd.startTime!""}</td>-->
                                <!--<td>${orderCenterCmd.statusStr!""}</td>-->

                                <!--<td id="operation" value="${orderCenterCmd.status}">-->
                                <!--<#list orderCenterCmd.operation as op>-->
                                <!--<a href="javascript:void(0);" onclick="handlerOrder(${op.code},${orderCenterCmd.orderId})">${op.message!"查看"}</a>-->
                                <!--</#list>-->
                                <!--</td>-->


                                <!--</#list>-->

                            </tr>
                        </table>
                        <!-- </div> -->
                    </div>

                </div>
                <!-- 我收到 -->
                <div class="tab-pane fade" id="tab2">
                    <div class="row">
                        <!-- <div class="col-sm-12"> -->
                        <table id="table2" data-toggle="table" data-pagination="true" data-search="true"
                               data-use-row-attr-func="true" data-reorderable-rows="true">
                            <thead>
                            <tr>
                                <th data-field="name-hasEvl" data-sortable="true">
                                    资产名称
                                </th>
                                <th data-field="desc-hasEvl" data-sortable="true">
                                    描述
                                </th>
                                <th data-field="detail-hasEvl" data-sortable="true">
                                    扫描文件
                                </th>
                                <th data-field="status-hasEvl" data-sortable="true">
                                    状态
                                </th>
                                <th data-field="update-hasEvl" data-sortable="true">
                                    更新时间
                                </th>
                                <th data-field="operations-hasEvl" data-sortable="true">
                                    操作
                                </th>

                            </tr>
                            </thead>
                            <!--<tr>-->
                            <!--</tr>-->
                        </table>
                        <!-- </div> -->
                    </div>
                </div>

            </div>
        </div>
    </div>
</div>

<!-- 资产评估 模态框  -->
<div class="modal inmodal" id="myModal" tabindex="-1" role="dialog" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content animated flipInX">
            <div class="modal-body">
                <form class="form-horizontal" role="form" id="assessmentForm">
                    <!-- 评估意见 -->
                    <input type="hidden" id="assetId" value=""/>
                    <div class="form-group">
                        <label for="opinion" class="col-xs-3 control-label">评估意见</label>
                        <div class="col-xs-7">
                            <textarea type="text" class="form-control" name="opinion" id="opinion" placeholder="请输入评估意见" name="appeal" style="resize:none;" data-bv-field="appeal"></textarea>
                        </div>
                    </div>
                    <!-- 评估价值 -->
                    <div class="form-group">
                        <label for="worth" class="col-xs-3 control-label">评估价值</label>
                        <div class="col-xs-7">
                            <div class="input-group">
                                <input type="text" class="form-control" name="worth" id="worth" placeholder="请输入评估价值">
                                <span class="input-group-btn">
								        	<button class="btn btn-default" type="button">元</button>
								     	</span>
                            </div>
                        </div>

                    </div>
                    <!-- 服务收费 -->
                    <div class="form-group">
                        <label for="charge" class="col-xs-3 control-label">服务收费</label>
                        <div class="col-xs-7">
                            <div class="input-group">
                                <input type="text" class="form-control" name="charge" id="charge" placeholder="请输入服务收费">
                                <span class="input-group-btn">
								        	<button class="btn btn-default" type="button">元</button>
								     	</span>
                            </div>
                        </div>

                    </div>
                    <!-- 预期收益 -->
                    <div class="form-group">
                        <label for="earnings" class="col-xs-3 control-label">预期收益</label>
                        <div class="col-xs-7">
                            <div class="input-group">
                                <input type="text" class="form-control" name="earnings" id="earnings" placeholder="请输入预期收益">
                                <span class="input-group-btn">
								        	<button class="btn btn-default" type="button">%</button>
								     	</span>
                            </div>
                        </div>

                    </div>
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label"></label>
                        <div class="col-xs-7">
                            <div class="row">
                                <button type="button" class="col-xs-4 col-xs-offset-1 btn btn-default" data-dismiss="modal">
                                    取消
                                </button>
                                <button type="submit" class="col-xs-4 col-xs-offset-1 btn btn-success" id="agree">
                                    确认
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<!--发行人信息-->
<div class="modal inmodal bs-example-modal-sm" id="myModal3" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog">
        <div class="modal-content animated flipInX">
            <div class="modal-body">
                <form class="form-horizontal" role="form" >
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label">发行人</label>
                        <div class="col-xs-6">
                            <div class="input-group">
                                <span class="form-control" id="publishMan" ></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label">证件类型</label>
                        <div class="col-xs-6">
                            <div class="input-group">
                                <span class="form-control"  >身份证</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label">证件号码</label>
                        <div class="col-xs-6">
                            <div class="input-group">
                                <span class="form-control" id="identity" ></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label">联系电话</label>
                        <div class="col-xs-6">
                            <div class="input-group">
                                <span class="form-control" id="telephone" ></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label">邮箱</label>
                        <div class="col-xs-6">
                            <div class="input-group">
                                <span class="form-control" id="email" ></span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="registerNmae" class="col-xs-3 control-label"></label>
                        <div class="col-xs-6">
                            <div class="row">
                                <button data-dismiss="modal" class="col-xs-4 col-xs-offset-1 btn ">
                                    取消
                                </button>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
<script>
    console.log(window.parent.roleNum);
    var data = new Array();
    // 表格嵌入数据
    $.get('/assets/waitevaluate', function (result) {
        //成功返回表格数据
        for (var i = 0; i < result.data.length; i++) {
            console.log(result.data[i]);
            // 点击资产名称跳连接
            data[i] = new Array();
//            data[i]["name"] = result.data[i].assetName;
            data[i]["name"] = "<a href=" + "/assetsDetail/corp/"+result.data[i].assetId+">" + result.data[i].assetName + "";;
            data[i]["id"] = result.data[i].assetId;
            data[i]["description"] = result.data[i]["desc"];
            data[i]["cycle"] = result.data[i]["cycle"];
            data[i]["publishName"] = '<div class="btn-group"><button type="button" onclick=\'alertUserInfo("'+result.data[i].issuerInfo.realName+'","'+result.data[i].issuerInfo.identity+'","'+result.data[i].telephone+'","'+result.data[i].issuerInfo.email+'")\' class="btn btn-default">'+result.data[i].issuerName+'</button> </div>',
            data[i]["operations"] = new Array();
            data[i]["operations"][0] = "<a href=\"javaScript:void(0)\" onclick=\"reject(" + result.data[i].assetId + ")\">驳回</a>";
            data[i]["operations"][1] = "<a href=\"javaScript:void(0)\" data-toggle=\"modal\" data-target=\"#myModal\" onclick=\"selfModal("+result.data[i].assetId+")\" \">同意</a>";
        }
        console.log(data);
        $("#table1").bootstrapTable("load", {
            data: data
        });
    })
    function hasEvl()
    {
        var data1 = new Array();
        $.get('/assets/evaluated', function (result) {
            //成功返回表格数据
            for (var i = 0; i < result.data.length; i++) {
                console.log(result.data[i]);
                // 点击资产名称跳连接
                data1[i] = new Array();
                data1[i]["name-hasEvl"] = result.data[i].assetName;
                data1[i]["desc-hasEvl"] = result.data[i]["desc"];
                data1[i]["detail-hasEvl"] = "<a href=" + "/assetsDetail/corp/" + result.data[i].assetId + ">点击查看";
                data1[i]["status-hasEvl"] = result.data[i]["status"]["message"];
                data1[i]["update-hasEvl"] = result.data[i]["updateTimeStr"];
                data1[i]["operations-hasEvl"] = new Array();
                for (var j = 0; j < result.data[i]["operations"].length; j++) {
                    data1[i]["operations-hasEvl"].push( "<a href=\"javascript:void(0)\" onclick=\"evledOperation(" + result.data[i].assetId + "," + result.data[i]["operations"][j]["code"] + ")\">" + result.data[i]["operations"][j]["message"] + "</a>");
                }
            }
            console.log(data);
            $("#table2").bootstrapTable("load", {
                data: data1
            });
        })
    }
    function alertUserInfo(name,identity,telephone,email) {
        $("#publishMan").text(name);
        $("#identity").text(identity);
        if(telephone=="null"){
            $("#telephone").text("");
        }else{
            $("#telephone").text(telephone);
        }
        if(email=="null"){
            $("#email").text("");
        }else{
            $("#email").text(email);
        }
        $("#myModal3").show();
    }
    function reject(assetId) {
        $.ajax({
            url : "assets/"+assetId+"/evaluate",
            type : "post",
            data : {"result":true},
            success: function(result){
                console.log(result);
                if(result.meta.code==200){
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html("驳回成功");
                    location.reload();
                }else{
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html(result.meta.message);
                    location.reload();
                }
            }
        })
    }
    function selfModal(assetId) {
        $("#assetId").val(assetId);
    }

    function evledOperation(assetId,operationCode) {
        switch (operationCode){
            case 7 : freeze(assetId);break;
            case 8 : unfreeze(assetId);break;
        }
    }
    function unfreeze(assetId) {
        $.ajax({
            url : "assets/"+assetId+"/unfreeze",
            type : "post",
            success: function(result){
                console.log(result);
                if(result.meta.code==200){
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html("解冻成功");
                    location.reload();
                }else{
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html(result.meta.message);
                    location.reload();
                }
            }
        })
    }
    function freeze(assetId) {
        $.ajax({
            url : "/assets/"+assetId+"/freeze",
            type : "post",
            success: function(result){
                console.log(result);
                if(result.meta.code==200){
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html("冻结成功");
                    location.reload();
                }else{
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html(result.meta.message);
                    location.reload();
                }
            }
        })
    }


    $('#assessmentForm').bootstrapValidator({
        message: 'This value is not valid',
        feedbackIcons: {
            valid: 'glyphicon glyphicon-ok',
            invalid: 'glyphicon glyphicon-remove',
            validating: 'glyphicon glyphicon-refresh'
        },
        fields: {

        }
    }).on('success.form.bv', function(e) {
        e.preventDefault();
        // 资产评估事件
        $.ajax({
            url : "assets/"+$("#assetId").val()+"/evaluate",
            type : "post",
            data : {"result":false,
                "conclusion":$("#opinion").val(),
                "value":$("#worth").val(),
                "fee":$("#charge").val(),
                "earnings":$("#earnings").val()},
            success: function(result){
                console.log(result);
                if(result.meta.code==200){
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html("评估成功");
                    location.reload();
                }else{
                    $("#modalAlert",parent.document).click();
                    $(".modal-body",parent.document).html(result.meta.message);
                    location.reload();
                }
            }
        })

    });
</script>
</html>