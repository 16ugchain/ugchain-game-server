<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="shortcut icon" type="image/x-icon" href="/images/favicon.ico">
	<!-- 网站作者 -->
	<meta name="author" content="51区块研发团队">
	<!-- 网站关键词 -->
	<meta name="keywords" content="51区块,数字资产">
	<!-- 网站描述 -->
	<meta name="description" content="51区块">

	<title>数字资产| 51区块</title>

	<!-- Bootstrap.css -->
	<link rel="stylesheet" href="http://cdn.bootcss.com/bootstrap/3.3.0/css/bootstrap.min.css">

	<!-- bootstrapValidator.css -->
	<link rel="stylesheet" href="//cdn.bootcss.com/bootstrap-validator/0.5.3/css/bootstrapValidator.min.css">

	<!-- public.css -->
	<link rel="stylesheet" href="/css/public.css">

	<!-- jQuery.js 1.11.1-->
	<script src="http://cdn.bootcss.com/jquery/1.11.1/jquery.min.js"></script>

	<!-- Bootstrap.js -->
	<script src="http://cdn.bootcss.com/bootstrap/3.3.0/js/bootstrap.min.js"></script>

	<script src="//cdn.bootcss.com/bootstrap-validator/0.5.3/js/bootstrapValidator.min.js"></script>

	<!--<script src="http://malsup.github.com/jquery.form.js"></script>-->

	<!-- vue.js -->
	<script src="//cdn.bootcss.com/vue/1.0.24/vue.js"></script>

	<!-- jquery.cookie.js -->
	<script src="//cdn.bootcss.com/jquery-cookie/1.4.1/jquery.cookie.js"></script>
	<script src="//cdn.bootcss.com/vue-router/0.7.10/vue-router.min.js"></script>
	<!-- 表格 -->
	<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.css">
	<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/bootstrap-table.min.js"></script>
	<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.0/locale/bootstrap-table-zh-CN.min.js"></script>
	<style>
		.bs-callout-success {
    		border-left: 3px solid #20b062;
    		padding-left: 5px;
    		font-weight: bold;
    		font-size: 18px;
    	}
	</style>
</head>
<body class="gray-bg">
    <div class="wrapper wrapper-content animated fadeIn container-fluid">
        <div class="row">
            <div class="col-sm-12">
                 <h3 class="bs-callout-success">
                	数字资产
                </h3>
            </div>
        </div>    
        <table id="table" data-toggle="table" data-pagination="true" data-search="true" data-use-row-attr-func="true" data-reorderable-rows="true">
        <!-- <table id="table" data-toggle="table" data-pagination="true" data-search="true" data-use-row-attr-func="true" data-reorderable-rows="true" data-url="/js/a.json"> -->
			<thead>
				<tr>
					<th data-field="name" data-sortable="true">
						资产名称
					</th>
					<th data-field="id" data-sortable="true">
						资产编号
					</th>
					<th data-field="publisher" data-sortable="true">
						发行人
					</th>
					<th data-field="share" data-sortable="true">
						持有份额
					</th>
					<th data-field="time" data-sortable="true">
						到期时间
					</th>
					<th data-field="guarantee" data-sortable="true">
						担保公司
					</th>
					<th data-field="status" data-sortable="true">
						状态
					</th>
					<th data-field="operation" data-sortable="true">
						操作
					</th>
					<!--<th data-field="contract" data-sortable="true">-->
						<!--电子合同-->
					<!--</th>-->
				</tr>
			</thead>

				<#list digitalAssetCmds as digitalAssetCmd>
					<tr>
					<!--<td>${digitalAssetCmd.assetName!""}</td>-->
						<td><a href="/assetsDetail/digitalPropertity/${digitalAssetCmd.assetId}">${digitalAssetCmd.assetName!""}</a></td>
					<td>${digitalAssetCmd.assetId!""}</td>
					<!--<td>${digitalAssetCmd.publishName!""}</td>-->
					<td><div class="btn-group"><button type="button" onclick='alertUserInfo("${digitalAssetCmd.issuerInfo.realName!""}","${digitalAssetCmd.issuerInfo.identity!""}","${digitalAssetCmd.telephone!""}","${digitalAssetCmd.issuerInfo.email!""}")' class="btn btn-default">${digitalAssetCmd.publishName!""}</button> </div></td>
					<td>${digitalAssetCmd.holdShare?c!""}</td>
					<td>${digitalAssetCmd.endTimeStr!""}</td>
					<!--<td>${digitalAssetCmd.status?c}</td>-->
					<td>${digitalAssetCmd.guarName!""}</td>
					<td>${digitalAssetCmd.statusStr!""}</td>
						<#if digitalAssetCmd.status!=3 >
							<td><label>-</label></td>
						<#elseif digitalAssetCmd.whollyOwner>
							<td><label><a href="#" onclick="applyDelivery(${digitalAssetCmd.assetId})" >申请交割</label></td>
							<#elseif digitalAssetCmd.tradeShare!=0>
									<td><input type="checkbox" checked="checked"  disabled="disabled" ><label><a href="#" value="${digitalAssetCmd.lockedShare}"  onclick="selfModal(${digitalAssetCmd.assetId},${digitalAssetCmd.lockedShare?c})"   data-toggle="modal" data-target="#myModal2">是否允许认购</label></td>

									<#else>
										<td><input type="checkbox" disabled="disabled" ><label ><a href="#" onclick="selfModal(${digitalAssetCmd.assetId},0)"  data-toggle="modal" data-target="#myModal2">是否允许认购</a></label></td>
						</#if>



					</tr>
				</#list>

		</table>
		<!-- 允许认购模态框 -->
		<div class="modal inmodal bs-example-modal-sm" id="myModal2" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="mySmallModalLabel">
			<div class="modal-dialog">
				<div class="modal-content animated flipInX">
					<div class="modal-body">
						<form class="form-horizontal" role="form" id="tradeModal">
							<!-- 认购份额 -->
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">允许认购份额</label>
								<div class="col-xs-6">
									<div class="input-group">
										<input type="text" class="form-control" id="tradeBalance" placeholder="请输入允许认购份额">
										<span class="input-group-btn">
								        	<button class="btn btn-default" type="button">股</button>
								     	</span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">锁定份额</label>
								<div class="col-xs-6" style="line-height: 30px;">
									<strong id="lockShare">0</strong>股
								</div>
							</div>
							<input type="hidden" id="assetId" value=""/>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label"></label>
								<div class="col-xs-6">
									<div class="row">
										<button data-dismiss="modal" class="col-xs-4 col-xs-offset-1 btn btn-default">
											取消
										</button>
										<button class="col-xs-4 col-xs-offset-1 btn btn-success">
											修改
										</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>

		<!--发行人信息-->
		<div class="modal inmodal bs-example-modal-sm" id="myModal3" tabindex="-1" role="dialog" aria-hidden="true" aria-labelledby="mySmallModalLabel">
			<div class="modal-dialog">
				<div class="modal-content animated flipInX">
					<div class="modal-body">
						<form class="form-horizontal" role="form" >
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">发行人</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="publishMan" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">证件类型</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control"  >身份证</span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">证件号码</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="identity" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">联系电话</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="telephone" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label">邮箱</label>
								<div class="col-xs-6">
									<div class="input-group">
										<span class="form-control" id="email" ></span>
									</div>
								</div>
							</div>
							<div class="form-group">
								<label for="registerNmae" class="col-xs-3 control-label"></label>
								<div class="col-xs-6">
									<div class="row">
										<button data-dismiss="modal" class="col-xs-4 col-xs-offset-1 btn ">
											取消
										</button>
									</div>
								</div>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
       	<script>
//       		var aaa = [
//			    {
//			    	"name":"Mr.Sofar",
//			        "id": 0,
//			        "publisher":"张先生",
//			        "share":"100%",
//			        "time": "2016-10-11",
//			        "guarantee":"北京点触",
//			        "status":"发行中",
//			        "operation":'<label><input type="checkbox" name="" value="">申请认购</label>',
//			        "contract":"<a><u>下载</u></a>"
//			    },
//			    {
//			    	"name":"Mr.Sofar",
//			        "id": 0,
//			        "publisher":"张先生",
//			        "share":"100%",
//			        "time": "2016-10-11",
//			        "guarantee":"北京点触",
//			        "status":"发行中",
//			        "operation":'<label><input type="checkbox" name="" value="">申请认购</label>',
//			        "contract":"<a><u>下载</u></a>"
//			    },
//
//			    {
//			    	"name":"Mr.Sofar",
//			        "id": 0,
//			        "publisher":"张先生",
//			        "share":"100%",
//			        "time": "2016-10-11",
//			        "guarantee":"北京点触",
//			        "status":"发行中",
//			        "operation":'<label><input type="checkbox" name="" value="">申请认购</label>',
//			        "contract":"<a><u>下载</u></a>"
//			    },
//			    {
//			    	"name":"Mr.Sofar",
//			        "id": 0,
//			        "publisher":"张先生",
//			        "share":"100%",
//			        "time": "2016-10-11",
//			        "guarantee":"北京点触",
//			        "status":"发行中",
//			        "operation":'<label><input type="checkbox" name="" value="">申请认购</label>',
//			        "contract":"<a><u>下载</u></a>"
//			    },
//			    {
//			    	"name":"Mr.Sofar",
//			        "id": 0,
//			        "publisher":"张先生",
//			        "share":"100%",
//			        "time": "2016-10-11",
//			        "guarantee":"北京点触",
//			        "status":"发行中",
//			        "operation":'<label><input type="checkbox" name="" value="">申请认购</label>',
//			        "contract":"<a><u>下载</u></a>"
//			    },
//			];
//    		$("#table").bootstrapTable({
//                data:aaa
//            });
function selfModal(assetId,tradeShare) {
	console.log(assetId);
	console.log(tradeShare);
	$("#lockShare").text(tradeShare);
	$("#assetId").val(assetId);
}
function alertUserInfo(name,identity,telephone,email) {
	$("#publishMan").text(name);
	$("#identity").text(identity);
	if(telephone=="null"){
		$("#telephone").text("");
	}else{
		$("#telephone").text(telephone);
	}
	if(email=="null"){
		$("#email").text("");
	}else{
		$("#email").text(email);
	}
	$("#myModal3").show();
}
function applyDelivery(assetId) {
	$.ajax({
		url : "/assets/"+assetId+"/applydelivery",
		type : "post",
		success: function(result){
			console.log(result);
			if(result.meta.code==200){
				$("#modalAlert",parent.document).click();
				$(".modal-body",parent.document).html("申请交割成功");
				location.reload();
			}else{
				$("#modalAlert",parent.document).click();
				$(".modal-body",parent.document).html(result.meta.message);
				location.reload();
			}
		}
	})
}
$('#tradeModal').bootstrapValidator({
	message: 'This value is not valid',
	feedbackIcons: {
		valid: 'glyphicon glyphicon-ok',
		invalid: 'glyphicon glyphicon-remove',
		validating: 'glyphicon glyphicon-refresh'
	},
	fields: {
		tradeBalance: {
			validators: {
				notEmpty: {
					message: '份额不能为空'
				}
			}
		}
	}
}).on('success.form.bv', function(e) {
	e.preventDefault();
	// 资产评估事件
	console.log($("#assetId").val());
	$.ajax({
		url : "/users/self/digitassets/"+$("#assetId").val()+"/tradebalance",
		type : "PUT",
		data : {
			"amount":$("#tradeBalance").val()},
		success: function(result){
			console.log(result);
			if(result.meta.code==200){
				$("#modalAlert",parent.document).click();
				$(".modal-body",parent.document).html("修改成功");
				location.reload();
			}else{
				$("#modalAlert",parent.document).click();
				$(".modal-body",parent.document).html(result.meta.message);
				location.reload();
			}
		}
	})

});
       	</script>
        
    </div>
</body>
</html>